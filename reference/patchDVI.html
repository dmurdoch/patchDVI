<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>patch Sweave source references into .dvi file — patchDVI • patchDVI</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="patch Sweave source references into .dvi file — patchDVI"><meta name="description" content="This package allows
source references in .dvi files to refer to the actual source file,
rather than the intermediate .tex file.  Dvi previewers such as yap
and xdvi can make use of these source references to jump directly
to the part of a document corresponding to a particular source line, and
the previewer can send messages to editors to jump to the source
corresponding to a location in the preview."><meta property="og:description" content="This package allows
source references in .dvi files to refer to the actual source file,
rather than the intermediate .tex file.  Dvi previewers such as yap
and xdvi can make use of these source references to jump directly
to the part of a document corresponding to a particular source line, and
the previewer can send messages to editors to jump to the source
corresponding to a location in the preview."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">patchDVI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/patchDVI.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dmurdoch/patchDVI/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>patch Sweave source references into .dvi file</h1>

      <div class="d-none name"><code>patchDVI.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This package allows
source references in .dvi files to refer to the actual source file,
rather than the intermediate .tex file.  Dvi previewers such as yap
and xdvi can make use of these source references to jump directly
to the part of a document corresponding to a particular source line, and
the previewer can send messages to editors to jump to the source
corresponding to a location in the preview.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">patchDVI</span><span class="op">(</span><span class="va">f</span>, newname <span class="op">=</span> <span class="va">f</span>, patchLog <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">patchSynctex</span><span class="op">(</span><span class="va">f</span>, newname<span class="op">=</span><span class="va">f</span>, uncompress<span class="op">=</span><span class="st">"pdftk %s output %s uncompress"</span>,</span>
<span>       fromDVI <span class="op">=</span> <span class="cn">NULL</span>, patchLog <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>A character value giving the name of the .dvi or .synctex file to patch</p></dd>

  <dt id="arg-newname">newname<a class="anchor" aria-label="anchor" href="#arg-newname"></a></dt>
<dd><p>Output will go to this file; by default to overwrite the original</p></dd>

  <dt id="arg-patchlog">patchLog<a class="anchor" aria-label="anchor" href="#arg-patchlog"></a></dt>
<dd><p>Whether to attempt to patch the <code class="file">.log</code> file</p></dd>

  <dt id="arg-uncompress">uncompress<a class="anchor" aria-label="anchor" href="#arg-uncompress"></a></dt>
<dd><p>External command to uncompress a compressed PDF file</p></dd>

  <dt id="arg-fromdvi">fromDVI<a class="anchor" aria-label="anchor" href="#arg-fromdvi"></a></dt>
<dd><p>Name of DVI file in which to find concordance</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function works with <code>Sweave</code> with option <code>concordance=TRUE</code>
and some related functions.</p>
<p>Using <code>patchDVI</code> requires a change to the usual Sweave workflow, as follows:</p>
<p>1.  Write the source file in .Rnw.  Include the</p><div class="sourceCode"><pre><code>\SweaveOpts{concordance=TRUE}</code></pre></div><p>option to
enable the patching.</p>
<p>2.  Use Sweave to convert the file to .tex format.</p>
<p>3.  Use latex to process the .tex file into a .dvi file or .pdf file.</p>
<p>4.  Run <code>patchDVI</code> on the .dvi file or the .synctex file to patch in the Rnw links.</p>
<p>5.  Use the previewer on the patched .dvi file or the original .pdf file.</p>
<p>All the information needed for the patching is stored in the .dvi file, so these 5 steps
can be run from the command line, there's no need to keep an R session running (though they'll
all work from within one session as well).  At some distant date in the future maybe
the previewers will learn how to read the concordance info, and step 4 will no longer be
necessary.</p>
<p>The <code>patchLog</code> option makes use of the new <code><a href="patchLog.html">patchLog</a></code> function.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>


<p>In a .dvi file, the concordance is stored in a TeX "special" in the following format (as of version 0.5):
<code>concordance:&lt;oldname&gt;:&lt;newname&gt;:&lt;firstline&gt; &lt;rle pairs&gt;*</code>.  Here <code>&lt;oldname&gt;</code>
is the name of the .tex file to replace, <code>&lt;newname&gt;</code> is the name of the .Rnw file
to substitute for it, and <code>&lt;firstline&gt;</code> is the line number from the .Rnw file of the
first line in the .tex file.</p>
<p>The <code>&lt;rle pairs&gt;</code> are a sequence of pairs
(length, value), separated by spaces (no parentheses), with the length indicating
the number of repetitions of the value.  Using <code><a href="https://rdrr.io/r/base/rle.html" class="external-link">inverse.rle</a></code> these are converted
to a sequence of differences in the line numbers of the concordance.</p>
<p>Since colons are used to delimit the elements, they must not be used
in <code>&lt;oldname&gt;</code> or <code>&lt;newname&gt;</code>:  names like
<code class="file">C:/source.Rnw</code> will not work.</p>
<p>For example, a concordance might contain</p><div class="sourceCode"><pre><code>\Sconcordance{\concordance:optimization.tex:optimization.Rnw:1 2 1 2 4 39 1 1 4 ...}</code></pre></div><p>saying that source references to optimization.tex should be replaced with
optimization.Rnw.  Line 1 of the .tex file corresponds to line 1 of the .Rnw file.
The diffs for successive lines are <code>1 1 4 4 1 &lt;repeated 39 times&gt; 4 ...</code>, so
the corresponding lines in the .Rnw file (including the first) are <code>1 2 3 7 11 12 13 ...</code>.</p>
<p>The same format is used in a stream object in a .pdf file. (Version 2.12.2 and
earlier of R used a different format which was actually invalid according to
the PDF specification.)  This is not always
successfully read by the patching code, because some versions of <code>pdflatex</code>
compress parts of the file, and <code>patchDVI</code> currently can't read compressed parts
of files.  We suggest installing the <code>pdftk</code> open source PDF toolkit
(available from <a href="https://www.pdflabs.com/tools/pdftk-the-pdf-toolkit/" class="external-link">https://www.pdflabs.com/tools/pdftk-the-pdf-toolkit/</a>) to decompress
the file; <code>patchSynctex</code> will make use of it
if found.  The <code>uncompress</code> argument can be modified to call a different
uncompress utility.  The Latex commands
<code>\pdfcompresslevel=0\pdfobjcompresslevel=0</code> at the start
of your document instruct <code>pdflatex</code> not to compress the file, but
some Latex packages (e.g. beamer) will override these settings.</p>
<p>If your workflow involves using <code>latex</code> and <code>dvipdfm</code>, then you will
need a recent enough version of <code>latex</code> that supports the <code>-synctex=1</code>
option, and then you can specify the name of the <code class="file">.dvi</code> file
in the <code>fromDVI</code> argument.</p>
<p>This format is subject to change in future R releases.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A string containing a message about what was done.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>The yap previewer is part of MikTeX, from www.miktex.org.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Duncan Murdoch</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="DVIspecials.html">DVIspecials</a></code> for the function to read .dvi files,
<code><a href="SweaveMiktex.html">SweaveMiktex</a></code> for a simple script to run Sweave, MikTeX and patchDVI.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu">patchDVI</span><span class="op">(</span><span class="st">"mypaper.dvi"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Duncan Murdoch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

